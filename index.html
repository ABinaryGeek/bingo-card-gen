<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Bingo</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css"
      integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54="
      crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css"
      integrity="sha256-Q0zCrUs2IfXWYx0uMKJfG93CvF6oVII21waYsAV4/8Q="
      crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css?family=Suez+One|Varela+Round"
      rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />

    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/solid.js"
      integrity="sha384-GJiigN/ef2B3HMj0haY+eMmG4EIIrhWgGJ2Rv0IaWnNdWdbWPr1sRLkGz7xfjOFw"
      crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/fontawesome.js"
      integrity="sha384-2OfHGv4zQZxcNK+oL8TR9pA+ADXtUODqGpIRy1zOgioC4X3+2vbOAp5Qv7uHM4Z8"
      crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js"
      integrity="sha256-hIvIxeqhGZF+VVeM55k0mJvWpQ6gTkWk3Emc+NmowYA="
      crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"
      integrity="sha256-nRoO8HoupfqozUr7YKBRgHXmdx40Hl/04OSBzv7e7L8="
      crossorigin="anonymous"></script>
    <script src="d3plus-text.full.min.js"></script>
    <script src="saveSvgAsPng.js"></script>
    <script src="bingo.js"></script>
  </head>

  <body>
    <script>
      const clipboard = new ClipboardJS(".copy-button");
      const app = Elm.Main.init();
      app.ports.textBoxesOut.subscribe(function(data) {
        new d3plus.TextBox()
            .data(data.squares)
            .fontResize(true)
            .verticalAlign("middle")
            .textAnchor("middle")
            .fontWeight(900)
            .fontFamily(["Varela Round", "sans-serif"])
            .select(".bingo-card .text-overlay .values")
            .render();
        new d3plus.TextBox()
            .data([data.title])
            .fontResize(true)
            .verticalAlign("middle")
            .textAnchor("middle")
            .fontMax(100)
            .fontFamily("Suez One", "serif")
            .select(".bingo-card .text-overlay .titles")
            .render();
      });
      app.ports.codeOut.subscribe(function(code) {
        let result;
        if (code.compressed) {
          try {
            result = {
              compressed: false,
              code: JSON.parse(LZString.decompressFromEncodedURIComponent(code.code))
            };
          } catch (e) {
            result = {
              error: e.message
            }
          }
        } else {
          result = {
            compressed: true,
            code: LZString.compressToEncodedURIComponent(JSON.stringify(code.code))
          };
        }
        app.ports.codeIn.send(result);
      });
      app.ports.saveOut.subscribe(function(name) {
        saveSvgAsPng(document.querySelectorAll(".bingo-card")[0], name + ".png");
      });
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("offline.js");
      }
      document.addEventListener("dragstart", function(event) {
        event.dataTransfer.setData("text/plain", "");
      }, false);
    </script>
  </body>
</html>
